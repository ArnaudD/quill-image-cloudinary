{
  "version": 3,
  "sources": ["../src/index.js", "../src/ResponsiveImageBlot.js"],
  "sourcesContent": ["import Quill from \"quill\";\n\nimport ResponsiveImage from \"./ResponsiveImageBlot\";\n\nQuill.register(ResponsiveImage);\n\nconst defaultOptions = {\n  preloadMediaLibrary: true,\n};\n\nclass QuillImageCloudinary {\n  constructor(quill, options) {\n    this.quill = quill;\n    this.options = { ...defaultOptions, ...options };\n    this.range = null;\n\n    if (this.options.srcset) {\n      this.options.srcset = this.options.srcset.sort((a, b) => a - b);\n    }\n\n    if (typeof this.options.getAuthOption !== \"function\") {\n      console.warn(\"'getAuthOption' function is missing in quill-image-cloudinary config.\");\n    }\n\n    var toolbar = this.quill.getModule(\"toolbar\");\n    toolbar.addHandler(\"image\", this.selectImage.bind(this));\n\n    if (this.options.preloadMediaLibrary) {\n      this.loadMediaLibrary();\n    }\n  }\n\n  loadMediaLibrary() {\n    if (!this.ml) {\n      const otherOptions = this.options.srcset\n        ? {\n            default_transformations: this.options.srcset.map((size) => [\n              {\n                width: size,\n                crop: \"scale\",\n                fetch_format: \"auto\",\n                quality: \"auto\",\n                ...(this.options.defaultTransformations || []),\n              },\n            ]),\n          }\n        : undefined;\n\n      const init = async () =>\n        window.cloudinary.createMediaLibrary(\n          {\n            ...(await this.options.getAuthOption()),\n            ...otherOptions,\n          },\n          {\n            insertHandler: this.fileChanged.bind(this),\n            multiple: false,\n            resource_type: \"image\",\n          }\n        );\n\n      this.ml = init();\n    }\n\n    return this.ml;\n  }\n\n  async selectImage() {\n    this.range = this.quill.getSelection();\n    const ml = await this.loadMediaLibrary();\n    ml.show(this.options.getShowOption ? await this.options.getShowOption() : undefined);\n  }\n\n  fileChanged({ assets: [image] }) {\n    console.log(image);\n    const { srcset } = this.options;\n\n    const range = this.range;\n    this.quill.insertEmbed(\n      range.index,\n      \"cloudinary-image\",\n      {\n        src: (srcset ? image.derived[srcset.length - 1] : image).secure_url,\n        srcset: srcset\n          ? image.derived\n              .map(({ secure_url }, index) => `${secure_url} ${srcset[index]}w`)\n              .join(\", \")\n          : undefined,\n      },\n      \"user\"\n    );\n    range.index++;\n    this.quill.setSelection(range, \"user\");\n  }\n}\n\nwindow.QuillImageCloudinary = QuillImageCloudinary;\nexport default QuillImageCloudinary;\n", "import Quill from \"quill\";\n\nconst EmbedBlot = Quill.import(\"blots/embed\");\n\nconst ATTRIBUTES = [\"alt\", \"height\", \"width\", \"src\", \"srcset\", \"loading\", \"style\", \"data-align\"];\n\nclass ResponsiveImage extends EmbedBlot {\n  static create(value) {\n    const node = super.create();\n    if (typeof value === \"string\") {\n      node.setAttribute(\"src\", value);\n    } else {\n      Object.keys(value).forEach((attribute) => {\n        if (ATTRIBUTES.includes(attribute) && value[attribute]) {\n          node.setAttribute(attribute, value[attribute]);\n        }\n      });\n    }\n\n    node.setAttribute(\"loading\", \"lazy\");\n\n    return node;\n  }\n\n  static formats(domNode) {\n    return ATTRIBUTES.reduce((formats, attribute) => {\n      if (domNode.hasAttribute(attribute)) {\n        formats[attribute] = domNode.getAttribute(attribute);\n      }\n      return formats;\n    }, {});\n  }\n\n  static register() {\n    if (/Firefox/i.test(navigator.userAgent)) {\n      setTimeout(() => {\n        // Disable image resizing in Firefox\n        document.execCommand(\"enableObjectResizing\", false, false);\n      }, 1);\n    }\n  }\n\n  static value(domNode) {\n    return {\n      src: domNode.getAttribute(\"src\"),\n      srcset: domNode.getAttribute(\"srcset\"),\n      alt: domNode.getAttribute(\"alt\"),\n    };\n  }\n\n  format(name, value) {\n    if (ATTRIBUTES.includes(name)) {\n      if (value) {\n        this.domNode.setAttribute(name, value);\n      } else {\n        this.domNode.removeAttribute(name);\n      }\n    } else {\n      super.format(name, value);\n    }\n  }\n}\nResponsiveImage.blotName = \"cloudinary-image\";\nResponsiveImage.tagName = \"IMG\";\nResponsiveImage.className = \"ql-cloudinary-image\";\n\nexport default ResponsiveImage;\n"],
  "mappings": "siBAAA,qBCAA,qBAEA,GAAM,GAAY,EAAM,OAAO,eAEzB,EAAa,CAAC,MAAO,SAAU,QAAS,MAAO,SAAU,UAAW,QAAS,cAEnF,eAA8B,EAAU,OAC/B,QAAO,EAAO,CACnB,GAAM,GAAO,MAAM,SACnB,MAAI,OAAO,IAAU,SACnB,EAAK,aAAa,MAAO,GAEzB,OAAO,KAAK,GAAO,QAAQ,AAAC,GAAc,CACxC,AAAI,EAAW,SAAS,IAAc,EAAM,IAC1C,EAAK,aAAa,EAAW,EAAM,MAKzC,EAAK,aAAa,UAAW,QAEtB,QAGF,SAAQ,EAAS,CACtB,MAAO,GAAW,OAAO,CAAC,EAAS,IAC7B,GAAQ,aAAa,IACvB,GAAQ,GAAa,EAAQ,aAAa,IAErC,GACN,UAGE,WAAW,CAChB,AAAI,WAAW,KAAK,UAAU,YAC5B,WAAW,IAAM,CAEf,SAAS,YAAY,uBAAwB,GAAO,KACnD,SAIA,OAAM,EAAS,CACpB,MAAO,CACL,IAAK,EAAQ,aAAa,OAC1B,OAAQ,EAAQ,aAAa,UAC7B,IAAK,EAAQ,aAAa,QAI9B,OAAO,EAAM,EAAO,CAClB,AAAI,EAAW,SAAS,GACtB,AAAI,EACF,KAAK,QAAQ,aAAa,EAAM,GAEhC,KAAK,QAAQ,gBAAgB,GAG/B,MAAM,OAAO,EAAM,KAIzB,EAAgB,SAAW,mBAC3B,EAAgB,QAAU,MAC1B,EAAgB,UAAY,sBAE5B,GAAO,GAAQ,ED9Df,EAAM,SAAS,GAEf,GAAM,GAAiB,CACrB,oBAAqB,IAGvB,OAA2B,CACzB,YAAY,EAAO,EAAS,CAC1B,KAAK,MAAQ,EACb,KAAK,QAAU,OAAK,GAAmB,GACvC,KAAK,MAAQ,KAET,KAAK,QAAQ,QACf,MAAK,QAAQ,OAAS,KAAK,QAAQ,OAAO,KAAK,CAAC,EAAG,IAAM,EAAI,IAG3D,MAAO,MAAK,QAAQ,eAAkB,YACxC,QAAQ,KAAK,yEAGf,GAAI,GAAU,KAAK,MAAM,UAAU,WACnC,EAAQ,WAAW,QAAS,KAAK,YAAY,KAAK,OAE9C,KAAK,QAAQ,qBACf,KAAK,mBAIT,kBAAmB,CACjB,GAAI,CAAC,KAAK,GAAI,CACZ,GAAM,GAAe,KAAK,QAAQ,OAC9B,CACE,wBAAyB,KAAK,QAAQ,OAAO,IAAI,AAAC,GAAS,CACzD,GACE,MAAO,EACP,KAAM,QACN,aAAc,OACd,QAAS,QACL,KAAK,QAAQ,wBAA0B,OAIjD,OAEE,EAAO,IAAS,wBACpB,cAAO,WAAW,mBAChB,OACM,KAAM,MAAK,QAAQ,iBACpB,GAEL,CACE,cAAe,KAAK,YAAY,KAAK,MACrC,SAAU,GACV,cAAe,YAIrB,KAAK,GAAK,IAGZ,MAAO,MAAK,GAGR,aAAc,gCAClB,KAAK,MAAQ,KAAK,MAAM,eAExB,AADW,MAAM,MAAK,oBACnB,KAAK,KAAK,QAAQ,cAAgB,KAAM,MAAK,QAAQ,gBAAkB,UAG5E,YAAY,CAAE,OAAQ,CAAC,IAAU,CAC/B,QAAQ,IAAI,GACZ,GAAM,CAAE,UAAW,KAAK,QAElB,EAAQ,KAAK,MACnB,KAAK,MAAM,YACT,EAAM,MACN,mBACA,CACE,IAAM,GAAS,EAAM,QAAQ,EAAO,OAAS,GAAK,GAAO,WACzD,OAAQ,EACJ,EAAM,QACH,IAAI,CAAC,CAAE,cAAc,IAAU,GAAG,KAAc,EAAO,OACvD,KAAK,MACR,QAEN,QAEF,EAAM,QACN,KAAK,MAAM,aAAa,EAAO,UAInC,OAAO,qBAAuB,EAC9B,GAAO,GAAQ",
  "names": []
}
