var y=Object.defineProperty;var f=Object.getOwnPropertySymbols;var A=Object.prototype.hasOwnProperty,w=Object.prototype.propertyIsEnumerable;var p=(s,t,i)=>t in s?y(s,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):s[t]=i,n=(s,t)=>{for(var i in t||(t={}))A.call(t,i)&&p(s,i,t[i]);if(f)for(var i of f(t))w.call(t,i)&&p(s,i,t[i]);return s};var u=(s,t,i)=>new Promise((e,r)=>{var a=o=>{try{c(i.next(o))}catch(d){r(d)}},b=o=>{try{c(i.throw(o))}catch(d){r(d)}},c=o=>o.done?e(o.value):Promise.resolve(o.value).then(a,b);c((i=i.apply(s,t)).next())});import M from"quill";import q from"quill";var O=q.import("blots/embed"),h=["alt","height","width","src","srcset","loading","style","data-align"],l=class extends O{static create(t){let i=super.create();return typeof t=="string"?i.setAttribute("src",t):Object.keys(t).forEach(e=>{h.includes(e)&&t[e]&&i.setAttribute(e,t[e])}),i.setAttribute("loading","lazy"),i}static formats(t){return h.reduce((i,e)=>(t.hasAttribute(e)&&(i[e]=t.getAttribute(e)),i),{})}static register(){/Firefox/i.test(navigator.userAgent)&&setTimeout(()=>{document.execCommand("enableObjectResizing",!1,!1)},1)}static value(t){return{src:t.getAttribute("src"),srcset:t.getAttribute("srcset"),alt:t.getAttribute("alt")}}format(t,i){h.includes(t)?i?this.domNode.setAttribute(t,i):this.domNode.removeAttribute(t):super.format(t,i)}};l.blotName="cloudinary-image";l.tagName="IMG";l.className="ql-cloudinary-image";var m=l;M.register(m);var x={preloadMediaLibrary:!0},g=class{constructor(t,i){this.quill=t,this.options=n(n({},x),i),this.range=null,this.options.srcset&&(this.options.srcset=this.options.srcset.sort((r,a)=>r-a)),typeof this.options.getAuthOption!="function"&&console.warn("'getAuthOption' function is missing in quill-image-cloudinary config.");var e=this.quill.getModule("toolbar");e.addHandler("image",this.selectImage.bind(this)),this.options.preloadMediaLibrary&&this.loadMediaLibrary()}loadMediaLibrary(){if(!this.ml){let t=this.options.srcset?{default_transformations:this.options.srcset.map(e=>[n({width:e,crop:"scale",fetch_format:"auto",quality:"auto"},this.options.defaultTransformations||[])])}:void 0,i=()=>u(this,null,function*(){return window.cloudinary.createMediaLibrary(n(n({},yield this.options.getAuthOption()),t),{insertHandler:this.fileChanged.bind(this),multiple:!1,resource_type:"image"})});this.ml=i()}return this.ml}selectImage(){return u(this,null,function*(){this.range=this.quill.getSelection(),(yield this.loadMediaLibrary()).show(this.options.getShowOption?yield this.options.getShowOption():void 0)})}fileChanged({assets:[t]}){console.log(t);let{srcset:i}=this.options,e=this.range;this.quill.insertEmbed(e.index,"cloudinary-image",{src:(i?t.derived[i.length-1]:t).secure_url,srcset:i?t.derived.map(({secure_url:r},a)=>`${r} ${i[a]}w`).join(", "):void 0},"user"),e.index++,this.quill.setSelection(e,"user")}};window.QuillImageCloudinary=g;var E=g;export{E as default};
//# sourceMappingURL=index.esm.js.map
